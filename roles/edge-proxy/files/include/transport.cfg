route[SETUP_BY_TRANSPORT] {

	if ($ru =~ "transport=ws") {
		xlog("L_INFO", "Request going to WS");
		if(sdp_with_transport("RTP/SAVPF")) {
                        rtpengine_manage("trust-address replace-origin replace-session-connection ICE=force");
                        t_on_reply("REPLY_WS_TO_WS");
                } else {
		    rtpengine_manage("trust-address replace-origin replace-session-connection ICE=force RTP/SAVPF");
		    t_on_reply("REPLY_FROM_WS");
                }
	}
	else if ($proto =~ "ws") {
		xlog("L_INFO", "Request coming from WS");
		rtpengine_manage("trust-address replace-origin replace-session-connection rtcp-mux-demux ICE=remove RTP/AVP direction=external direction=internal");
		t_on_reply("REPLY_TO_WS");
	}
	else {
		xlog("L_INFO", "This is a classic phone call");
		rtpengine_manage("replace-origin replace-session-connection");
		t_on_reply("MANAGE_CLASSIC_REPLY");
	}
}

